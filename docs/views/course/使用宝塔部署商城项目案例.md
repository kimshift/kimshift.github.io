---
title: 宝塔部署商城项目案例
date: 2023-05-31 14:12:39
categories:
  - 教程
tags:
  - 宝塔
  - 网站部署
isShowComments: false
---

## 部署前准备

### 安装所需软件/服务

- MySQL 服务（ 5.7.34）
- phpMyAdmin（5.1）
- PM2 管理器（5.2）
- Nginx（1.19.8)

![H0caeddb00c0c4494b33e91f11ef559beH](https://www.file.kim-shift.cn/markdown/H0caeddb00c0c4494b33e91f11ef559beH.jpg)

### 创建数据库

- 上传数据库脚本文件
- 在宝塔面板中创建相应的数据库
- 将数据库文件导入数据库中
- 数据库其余操作过程省略不讲（不是此次案例的重点内容）

### 解析域名

- 在购买的域名 DNS 解析管理进行二级域名解析
- 如果没有就不做这个步骤

![Hbc20bda65e1b4c328248aba3510a2baf2](https://www.file.kim-shift.cn/markdown/Hbc20bda65e1b4c328248aba3510a2baf2.jpg)

### 开放端口

- 开放该案例所需要的端口：80（前端）、3002（后端）
- 云服务器控制台开放所需要的端口
- 宝塔面板放行端口

![H5dcd038945eb42d4b323097783bf63e7N](https://www.file.kim-shift.cn/markdown/H5dcd038945eb42d4b323097783bf63e7N.jpg)

## 商城后端服务器项目部署

### 打开宝塔面板首页

### 双击 PM2 管理器进入管理列表

![image-20210507175033900](https://www.file.kim-shift.cn/markdown/image-20210507175033900.png)

### 点击添加项目

![Hae4ce4d7dce14b3087212d212e7d7e750](https://www.file.kim-shift.cn/markdown/Hae4ce4d7dce14b3087212d212e7d7e750.jpg)

### 配置启动项目

- 启动文件：选择需要启动的文件或者输入脚本执行命令
- 运行目录：找到需要部署项目的根目录
- 项目名称：自定义即可

![He732cfbb1e094a55b9d3483cd63f65caK](https://www.file.kim-shift.cn/markdown/He732cfbb1e094a55b9d3483cd63f65caK.jpg)

### 部署成功

![Hc74fea5936b04f398ce95afc46769a11y](https://www.file.kim-shift.cn/markdown/Hc74fea5936b04f398ce95afc46769a11y.jpg)

## 商城前端项目(dist)部署

- 将打包构建好的 dist 文件上传到云服务器/www/wwwroot/ 文件路径下
- 将文件夹重命名为：trading-platform（根据个人自定义操作）

### 进入网站管理-添加站点

### 配置站点信息

![H8d82e2bf6bbf4ac8921d08a9ada5b4bdT](https://www.file.kim-shift.cn/markdown/H8d82e2bf6bbf4ac8921d08a9ada5b4bdT.jpg)

### 创建站点成功

![H9e820fb4eb4d4a39b6c3a86507a23079v](https://www.file.kim-shift.cn/markdown/H9e820fb4eb4d4a39b6c3a86507a23079v.jpg)

- 访问映射的域名：shop.kim-shift.cn 或者 www.shop.kim-shift.cn

![H1725f01ab8da427ba42ae9939ac8c7304](https://www.file.kim-shift.cn/markdown/H1725f01ab8da427ba42ae9939ac8c7304.jpg)

- 由于刚部署的前端是有 vue 构建打包的，而在开发环境配置的代理在生产环境（build 构建的 dist）是不生效的

- 开发环境代理的访问地址均为 404

![He83b6507284c4a4e8ec8e9b6e44a786az](https://www.file.kim-shift.cn/markdown/He83b6507284c4a4e8ec8e9b6e44a786az.jpg)

## Nginx 反向代理配置

使用 Nginx 代理来解决前端无法有效访问后端服务的问题，先部署好后端服务（不演示了），部署好后根据如下操作进行反向代理配置：

- 进入宝塔-网站-对应的网站点击设置

![Hde841ecd6a694e27bf779d89daedd697E](https://www.file.kim-shift.cn/markdown/Hde841ecd6a694e27bf779d89daedd697E.jpg)

- 修改代理配置：新增在开发环境中对应的三个代理
  - /api ==>请求服务前缀接口
  - /carousel ==>获取轮播图前缀接口
  - /uploads ==>获取上传文件前缀接口
- 创建反向代理

  - 开启高级功能
  - 代理名称（可自定义）
  - 代理目录：对应需要代理的接口路径
  - 目标 URL：所要代理到的后端服务
  - 发送域名：前端请求服务（默认即可）
  - /carousel 、/uploads 的代理配置与/api 的操作一致（已省略）

  ![H775e831c0f7b45b987ebe5486944c10cP](https://www.file.kim-shift.cn/markdown/H775e831c0f7b45b987ebe5486944c10cP.jpg)

- 配置完成

![H3b86e66893034bc38306f9f899002278P](https://www.file.kim-shift.cn/markdown/H3b86e66893034bc38306f9f899002278P.jpg)

- 分别点击这三个配置代理的配置文件进行修改（将这个部分删除掉）

```
location  ~* \.(gif|png|jpg|css|js|woff|woff2)$
{
    proxy_pass http://127.0.0.1:3002;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header REMOTE-HOST $remote_addr;
    expires 12h;
}
```

## 案例部署结束

- 访问网站：www.shop.kim-shift.cn

![H07ac90a39e554a6bb6e30aa7ad2ddf37b](https://www.file.kim-shift.cn/markdown/H07ac90a39e554a6bb6e30aa7ad2ddf37b.jpg)
